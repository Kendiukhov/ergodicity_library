<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ergodicity.tools.helper &#8212; Ergodicity Library 0.3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=e259d695"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ergodicity.tools.helper</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">helper Submodule</span>

<span class="sd">The `helper` submodule provides various utility functions designed to assist with data manipulation, visualization, and process encoding within stochastic process simulations. These helper functions streamline the workflow for saving results, plotting simulation data, encoding processes, and handling system-level data transformations. It is commonly used in conjunction with other modules such as `process`, `compute`, and `fit`.</span>

<span class="sd">Key Features:</span>

<span class="sd">1. **Data Manipulation**:</span>

<span class="sd">   - `separate`: A simple utility that separates time and process data from a given dataset. Often used to split simulation data into its respective components.</span>

<span class="sd">2. **Saving and Visualization**:</span>

<span class="sd">   - `save_to_file`: Saves simulation data to a specified directory. It can create necessary directories if they do not exist.</span>

<span class="sd">   - `visualize_process_from_data`: Visualizes the output of a stochastic process simulation.</span>

<span class="sd">   - `plot_simulate_ensemble`: Plots the results of an ensemble of simulated processes, showing portfolio evolution, asset weights, and geometric means.</span>

<span class="sd">   - `plot`: Plots the simulation results of custom processes with multiple instances.</span>

<span class="sd">   - `plot_system`: A more advanced plotting function designed for systems of stochastic differential equations (SDEs), where multiple equations are simulated simultaneously.</span>

<span class="sd">3. **Process Encoding**:</span>

<span class="sd">   - `ProcessEncoder`: A class designed to encode different stochastic processes and their parameters into a numeric representation. This is useful for handling multiple processes programmatically and standardizing their representation in simulations.</span>

<span class="sd">     - **Methods**:</span>

<span class="sd">       - `encode`: Encodes a process type as a unique integer.</span>

<span class="sd">       - `decode`: Decodes an integer back into the corresponding process type.</span>

<span class="sd">       - `encode_process`: Encodes a process instance into a list of floats, allowing for the serialization of its parameters.</span>

<span class="sd">       - `pad_encoded_process`: Pads the encoded process representation to ensure uniform length.</span>

<span class="sd">       - `encode_process_with_time`: Encodes a process along with a time value to preserve temporal information for the simulation.</span>

<span class="sd">4. **Parallelism**:</span>

<span class="sd">   - The module imports `ProcessPoolExecutor` to enable parallel execution, although no explicit parallel functionality is currently implemented in the given code. This suggests potential future extensions for parallel processing of simulations or fitting routines.</span>

<span class="sd">Example Usage:</span>

<span class="sd">data = np.random.randn(100, 50)  # Example data</span>

<span class="sd"># Save the data</span>

<span class="sd">save_to_file(data, output_dir=&quot;results&quot;, file_name=&quot;simulation_data&quot;, save=True)</span>

<span class="sd"># Plot the data</span>

<span class="sd">plot(data, num_instances=10, save=True, plot=True)</span>

<span class="sd"># Encode a process instance</span>

<span class="sd">encoder = ProcessEncoder()</span>

<span class="sd">encoded_process = encoder.encode_process(MyProcessClass())</span>

<span class="sd">print(&quot;Encoded process:&quot;, encoded_process)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">ergodicity.configurations</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ergodicity.process.default_values</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<div class="viewcode-block" id="separate">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.separate">[docs]</a>
<span class="k">def</span> <span class="nf">separate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Separate time and data from the given dataset.</span>

<span class="sd">    :param data: The dataset to separate</span>
<span class="sd">    :type data: numpy.ndarray</span>
<span class="sd">    :return: A tuple containing the time values and the data values</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">times</span><span class="p">,</span> <span class="n">data</span></div>


<div class="viewcode-block" id="save_to_file">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.save_to_file">[docs]</a>
<span class="k">def</span> <span class="nf">save_to_file</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the given data to a file in the specified output directory.</span>

<span class="sd">    :param data: The data to save</span>
<span class="sd">    :type data: numpy.ndarray</span>
<span class="sd">    :param output_dir: The directory to save the file in</span>
<span class="sd">    :type output_dir: str</span>
<span class="sd">    :param file_name: The name of the file to save</span>
<span class="sd">    :type file_name: str</span>
<span class="sd">    :param save: Whether to save the data</span>
<span class="sd">    :type save: bool</span>
<span class="sd">    :return: None</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)),</span> <span class="n">data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data saved to </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_simulate_ensemble">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.plot_simulate_ensemble">[docs]</a>
<span class="k">def</span> <span class="nf">plot_simulate_ensemble</span><span class="p">(</span><span class="n">simulation_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the results of the simulate_ensemble method.</span>

<span class="sd">    :param simulation_result: Dictionary containing &#39;portfolio&#39;, &#39;geometric_means&#39;, and &#39;weights&#39;</span>
<span class="sd">    :type simulation_result: Dict[str, Any]</span>
<span class="sd">    :param t: Total simulation time</span>
<span class="sd">    :type t: float</span>
<span class="sd">    :param save: Whether to save the plots as image files</span>
<span class="sd">    :type save: bool</span>
<span class="sd">    :return: None</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">portfolio</span> <span class="o">=</span> <span class="n">simulation_result</span><span class="p">[</span><span class="s1">&#39;portfolio&#39;</span><span class="p">]</span>
    <span class="n">geometric_means</span> <span class="o">=</span> <span class="n">simulation_result</span><span class="p">[</span><span class="s1">&#39;geometric_means&#39;</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">simulation_result</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>

    <span class="n">num_steps</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">num_instances</span> <span class="o">=</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Plot portfolio value and geometric mean</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">portfolio_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">portfolio</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">portfolio_value</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Portfolio Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">geometric_means</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Geometric Mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Evolution of Portfolio Value and Geometric Mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;portfolio_evolution.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Plot weight evolution</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Asset </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Evolution of Asset Weights&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;weight_evolution.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Plot individual asset paths</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">portfolio</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Asset </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Individual Asset Paths&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;asset_paths.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.plot">[docs]</a>
<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the simulation results of custom processes with multiple instances.</span>

<span class="sd">    :param data_full: The simulation data to plot</span>
<span class="sd">    :type data_full: numpy.ndarray</span>
<span class="sd">    :param num_instances: The number of instances to plot</span>
<span class="sd">    :type num_instances: int</span>
<span class="sd">    :param save: Whether to save the plots as image files</span>
<span class="sd">    :type save: bool</span>
<span class="sd">    :param plot: Whether to display the plots</span>
<span class="sd">    :type plot: bool</span>
<span class="sd">    :return: None</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">separate</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Visualization</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Simulation of the custom process&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_default</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;custom_process_simulation:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">_process_simulation.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_system">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.plot_system">[docs]</a>
<span class="k">def</span> <span class="nf">plot_system</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_equations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the simulation results of a system of stochastic differential equations (SDEs).</span>

<span class="sd">    :param data_full: The simulation data to plot</span>
<span class="sd">    :type data_full: numpy.ndarray</span>
<span class="sd">    :param num_instances: The number of instances to plot</span>
<span class="sd">    :type num_instances: int</span>
<span class="sd">    :param num_equations: The number of equations in the system</span>
<span class="sd">    :type num_equations: int</span>
<span class="sd">    :param save: Whether to save the plots as image files</span>
<span class="sd">    :type save: bool</span>
<span class="sd">    :param plot: Whether to display the plots</span>
<span class="sd">    :type plot: bool</span>
<span class="sd">    :return: None</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_equations</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_equations</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">eq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">num_equations</span> <span class="o">+</span> <span class="n">eq</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Equation </span><span class="si">{</span><span class="n">eq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_default</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;system_sde_simulation_t</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_dt</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_n</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="ProcessEncoder">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder">[docs]</a>
<span class="k">class</span> <span class="nc">ProcessEncoder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to encode different stochastic processes and their parameters into a numeric representation.</span>
<span class="sd">    It is neeeded for handling multiple processes programmatically and standardizing their representation in simulations.</span>
<span class="sd">    It is used in the submodules &#39;multiprocessing&#39; and &#39;automate&#39; of the &#39;compute&#39; module and in the &#39;agents&#39; module.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        process_types (dict): A dictionary mapping process types to their encoded integer values.</span>

<span class="sd">        reverse_mapping (dict): A dictionary mapping encoded integer values to their corresponding process types.</span>

<span class="sd">        next_id (int): The next available integer value for encoding a new process type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the ProcessEncoder with default process types and an empty reverse mapping.</span>

<span class="sd">        The default process types are:</span>
<span class="sd">        - BrownianMotion: 1</span>
<span class="sd">        - GeometricBrownianMotion: 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;BrownianMotion&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;GeometricBrownianMotion&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="mi">3</span>

<div class="viewcode-block" id="ProcessEncoder.encode">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.encode">[docs]</a>
    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encode a process type as a unique integer.</span>

<span class="sd">        :param process_type: The type of the process to encode</span>
<span class="sd">        :type process_type: str</span>
<span class="sd">        :return: The encoded integer value</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">process_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span><span class="p">[</span><span class="n">process_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">process_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span><span class="p">[</span><span class="n">process_type</span><span class="p">]</span></div>


<div class="viewcode-block" id="ProcessEncoder.decode">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.decode">[docs]</a>
    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode an integer back into the corresponding process type.</span>

<span class="sd">        :param process_id: The integer value to decode</span>
<span class="sd">        :type process_id: int</span>
<span class="sd">        :return: The decoded process type</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProcessEncoder.get_encoding">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.get_encoding">[docs]</a>
    <span class="k">def</span> <span class="nf">get_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the encoding of process types.</span>

<span class="sd">        :return: A dictionary mapping process types to their encoded integer values</span>
<span class="sd">        :rtype: Dict[str, int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span></div>


<div class="viewcode-block" id="ProcessEncoder.get_decoding">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.get_decoding">[docs]</a>
    <span class="k">def</span> <span class="nf">get_decoding</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the decoding of process types.</span>

<span class="sd">        :return: A dictionary mapping encoded integer values to their corresponding process types</span>
<span class="sd">        :rtype: Dict[int, str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mapping</span></div>


<div class="viewcode-block" id="ProcessEncoder.encode_process">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.encode_process">[docs]</a>
    <span class="k">def</span> <span class="nf">encode_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encode a process instance into a list of floats.</span>

<span class="sd">        :param process: A process instance</span>
<span class="sd">        :type process: object</span>
<span class="sd">        :return: A list of floats representing the encoded process</span>
<span class="sd">        :rtype: List[float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">process_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">process</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">process_type</span><span class="p">))]</span>

        <span class="c1"># Use the get_params method to retrieve process parameters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
        <span class="c1"># print(f&quot;Process parameters from the ProcessEncoder: {params}&quot;)</span>
        <span class="k">for</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">encoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">param_value</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Skipping non-numeric parameter with value </span><span class="si">{</span><span class="n">param_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># print(f&quot;Encoded process from the ProcessEncoder: {encoded}&quot;)</span>

        <span class="k">return</span> <span class="n">encoded</span></div>


<div class="viewcode-block" id="ProcessEncoder.pad_encoded_process">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.pad_encoded_process">[docs]</a>
    <span class="k">def</span> <span class="nf">pad_encoded_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoded_process</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">max_params</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pad the encoded process representation to ensure uniform length.</span>

<span class="sd">        :param encoded_process: The encoded process to pad</span>
<span class="sd">        :type encoded_process: List[float]</span>
<span class="sd">        :param max_params: The maximum number of parameters to include</span>
<span class="sd">        :type max_params: int</span>
<span class="sd">        :return: The padded encoded process</span>
<span class="sd">        :rtype: List[float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">padded</span> <span class="o">=</span> <span class="n">encoded_process</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Keep the process type</span>
        <span class="n">padded</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">encoded_process</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">max_params</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># Take up to max_params</span>
        <span class="n">padded</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_params</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">encoded_process</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>  <span class="c1"># Pad with zeros if needed</span>
        <span class="k">return</span> <span class="n">padded</span></div>


<div class="viewcode-block" id="ProcessEncoder.encode_process_with_time">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.ProcessEncoder.encode_process_with_time">[docs]</a>
    <span class="k">def</span> <span class="nf">encode_process_with_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="nb">object</span><span class="p">],</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encode a process with its time value, maintaining the original total length.</span>

<span class="sd">        :param process: The process to encode (either a dictionary or an object)</span>
<span class="sd">        :type process: Union[Dict, object]</span>
<span class="sd">        :param time: The time value to include in the encoding</span>
<span class="sd">        :type time: float</span>
<span class="sd">        :return: A list of floats representing the encoded process with time</span>
<span class="sd">        :rtype: List[float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoded_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_encoded_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encode_process</span><span class="p">(</span><span class="n">process</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">encoded_process</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">+</span> <span class="n">encoded_process</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>
</div>


<div class="viewcode-block" id="covariance_to_correlation">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.tools.html#ergodicity.tools.helper.covariance_to_correlation">[docs]</a>
<span class="k">def</span> <span class="nf">covariance_to_correlation</span><span class="p">(</span><span class="n">covariance_matrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a covariance matrix to a correlation matrix.</span>

<span class="sd">    :param covariance_matrix: The covariance matrix to convert</span>
<span class="sd">    :type covariance_matrix: numpy.ndarray</span>
<span class="sd">    :return: The correlation matrix</span>
<span class="sd">    :rtype: numpy.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Extract the diagonal elements (variances)</span>
    <span class="n">variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">covariance_matrix</span><span class="p">)</span>

    <span class="c1"># Calculate standard deviations</span>
    <span class="n">std_devs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>

    <span class="c1"># Create a diagonal matrix of inverse standard deviations</span>
    <span class="n">D_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">std_devs</span><span class="p">)</span>

    <span class="c1"># Calculate correlation matrix</span>
    <span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">D_inv</span> <span class="o">@</span> <span class="n">covariance_matrix</span> <span class="o">@</span> <span class="n">D_inv</span>

    <span class="k">return</span> <span class="n">correlation_matrix</span></div>



</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Ergodicity Library</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Ihor Kendiukhov.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>