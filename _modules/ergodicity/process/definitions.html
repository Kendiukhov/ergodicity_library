<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ergodicity.process.definitions &#8212; Ergodicity Library 0.3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=e259d695"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ergodicity.process.definitions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The `definitions.py` module lays the foundation for the Ergodicity Library, introducing core concepts and defining abstract classes for stochastic processes.</span>

<span class="sd">**Key Components:**</span>

<span class="sd">* **`Process` Class:**</span>

<span class="sd">    * The central abstract class for all stochastic processes in the library.</span>

<span class="sd">    * Provides a standardized interface for process initialization, property access, and common methods like simulation, moments calculation, and visualization.</span>

<span class="sd">* **`ItoProcess` and `NonItoProcess` Classes:**</span>

<span class="sd">    * Abstract subclasses of `Process` that categorize processes into Ito (subject to Ito calculus) and non-Ito types.</span>

<span class="sd">* **`CustomProcess` Class:**</span>

<span class="sd">    * Empowers users to create their own custom stochastic processes within the library&#39;s framework.</span>

<span class="sd">* **Decorators and Helper Functions:**</span>

<span class="sd">    * `simulation_decorator`: Enhances simulation methods with verbose output for easier tracking.</span>

<span class="sd">    * `check_simulate_with_differential`: Checks if a process&#39;s simulation uses differential methods.</span>

<span class="sd">    * `create_correlation_matrix` and `correlation_to_covariance`: Facilitate working with correlated processes.</span>

<span class="sd">**Core Functionalities:**</span>

<span class="sd">* **Process Initialization and Properties:**</span>

<span class="sd">    * Standardizes the creation and attribute access of processes, including names, multiplicative nature, independence of increments, and more.</span>

<span class="sd">* **Simulation:**</span>

<span class="sd">    * `simulate()`: Primary method for generating sample paths of a process.</span>

<span class="sd">    * `simulate_2d()` and `simulate_3d()`: Extend simulation to 2D and 3D processes.</span>

<span class="sd">    * `simulate_live_*`: Create dynamic visualizations of simulations.</span>

<span class="sd">* **Moments and Distributions:**</span>

<span class="sd">    * `moments()`: Calculates the cumulative moments (mean, variance, etc.) of a process.</span>

<span class="sd">    * `k_moments()`: Extends moment calculation to higher orders.</span>

<span class="sd">    * `simulate_distribution()`: Simulates the probability distribution of a process.</span>

<span class="sd">* **Analysis and Visualization:**</span>

<span class="sd">    * `ensemble_average()` and `time_average()`: Calculate ensemble and time averages.</span>

<span class="sd">    * `self_averaging_time()`: Estimates the time when a process transitions from ensemble-averaged to time-averaged behavior.</span>

<span class="sd">    * `plot*`, `visualize_moments`: Provide various plotting and visualization capabilities.</span>

<span class="sd">* **Ito-Specific Functionality:**</span>

<span class="sd">    * `solve()`: Attempts to find analytical solutions for Ito processes using Ito calculus.</span>

<span class="sd">    * `differential()`: Represents the stochastic differential equation of an Ito process.</span>

<span class="sd">**Intended Audience:**</span>

<span class="sd">* **Researchers and Practitioners:** Leverage the library&#39;s core definitions to work with and analyze a wide variety of stochastic processes.</span>

<span class="sd">* **Students and Learners:** Gain a deeper understanding of stochastic processes through the clear structure and implementation of fundamental concepts.</span>

<span class="sd">* **Developers:** Extend the library&#39;s capabilities by building upon these base classes and methods to create new process types and functionalities.</span>

<span class="sd">**Dependencies:**</span>

<span class="sd">    - abc.ABC: Provides support for defining abstract base classes (ABC) for ensuring proper subclass implementation.</span>

<span class="sd">    - typing.List, Any, Type, Callable: Used for type annotations to enforce type safety and clarity in function signatures.</span>

<span class="sd">    - numpy (np): Fundamental package for numerical computation, array manipulation, and random number generation.</span>

<span class="sd">    - matplotlib.pyplot (plt): Library for creating static, animated, and interactive visualizations.</span>

<span class="sd">    - matplotlib.animation: For creating dynamic animations of the simulated processes.</span>

<span class="sd">    - inspect: Used to inspect live objects, retrieve information about classes, functions, methods, and more.</span>

<span class="sd">    - sympy (sp): Symbolic mathematics library for defining and solving algebraic expressions and differential equations.</span>

<span class="sd">    - pandas.core.tools.times.to_time: Time handling and manipulation tool.</span>

<span class="sd">    - .default_values: Internal module that defines default constants used in simulations.</span>

<span class="sd">    - ergodicity.configurations: Module that defines custom configurations for the stochastic processes and models.</span>

<span class="sd">    - warnings: Provides a framework for issuing runtime warnings, used here for custom warnings.</span>

<span class="sd">    - threading: Module to run code concurrently via threads for efficient simulations.</span>

<span class="sd">    - os: Interface for interacting with the operating system, primarily for file handling and environment queries.</span>

<span class="sd">    - csv: For reading from and writing to CSV files.</span>

<span class="sd">    - subprocess: Allows for spawning new processes, connecting to their input/output/error pipes, and obtaining their return codes.</span>

<span class="sd">    - plotly.graph_objects (go): Advanced plotting library for interactive visualizations.</span>

<span class="sd">    - mpl_toolkits.mplot3d: Used for creating 3D plots with matplotlib.</span>

<span class="sd">    - ..custom_warnings: Defines custom warnings specific to this module, like `InDevelopmentWarning` and `KnowWhatYouDoWarning`.</span>

<span class="sd">    - ergodicity.tools.compute.growth_rate_of_average_per_time: Utility function for computing growth rates over time.</span>

<span class="sd">    - ergodicity.tools.compute.average: Utility function for calculating average values over a data set.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">pandas.core.tools.times</span> <span class="kn">import</span> <span class="n">to_time</span>
<span class="kn">from</span> <span class="nn">.default_values</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ergodicity.configurations</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">..custom_warnings</span> <span class="kn">import</span> <span class="n">InDevelopmentWarning</span><span class="p">,</span> <span class="n">KnowWhatYouDoWarning</span>
<span class="kn">from</span> <span class="nn">ergodicity.tools.compute</span> <span class="kn">import</span> <span class="n">growth_rate_of_average_per_time</span>
<span class="kn">from</span> <span class="nn">ergodicity.tools.compute</span> <span class="kn">import</span> <span class="n">average</span>

<div class="viewcode-block" id="Process">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process">[docs]</a>
<span class="k">class</span> <span class="nc">Process</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Process class is the base class for all processes in the Ergodicity Library.</span>
<span class="sd">    This is an abstract class.</span>
<span class="sd">    Here, the majority of the methods available for all classes related to stochastic processes are defined.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        name (str): The name of the process.</span>

<span class="sd">        multiplicative (bool): Whether the process is multiplicative.</span>

<span class="sd">        independent (bool): Whether the increments of the process are independent.</span>

<span class="sd">        ito (bool): Whether the process is an Ito process.</span>

<span class="sd">        process_class (Type[Any]): The class in the stochastic library that corresponds to the process.</span>

<span class="sd">        types (List[str]): Custom labels to categorize the process.</span>

<span class="sd">        comments (bool): Whether to display comments about the process when the code runs.</span>

<span class="sd">        has_wrong_params (bool): Whether the corresponding process in the stochastic library has parameters in an unexpected format.</span>

<span class="sd">        custom (bool): Whether the process is a custom process.</span>

<span class="sd">        simulate_with_differential (bool): Whether the process is simulated using differential methods.</span>

<span class="sd">        output_dir (str): The directory where the process results are saved.</span>

<span class="sd">        increment_process (bool): Whether the process is an increment process.</span>

<span class="sd">        memory (int): The memory of the process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">multiplicative</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">independent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">ito</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">process_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Process class.</span>

<span class="sd">        :param name: The name of the process</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param multiplicative: Whether the process is multiplicative</span>
<span class="sd">        :type multiplicative: bool</span>
<span class="sd">        :param independent: Whether the process increments are independent</span>
<span class="sd">        :type independent: bool</span>
<span class="sd">        :param ito: Whether the process is an Ito process</span>
<span class="sd">        :type ito: bool</span>
<span class="sd">        :param process_class: To what class in the stochastic library the process corresponds, if any</span>
<span class="sd">        :type process_class: Type[Any]</span>
<span class="sd">        :param kwargs: Process-specific parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Process&quot;</span>
        <span class="k">if</span> <span class="n">multiplicative</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">multiplicative</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">independent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">independent</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">multiplicative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">ito</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ito</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="o">=</span> <span class="n">multiplicative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_independent</span> <span class="o">=</span> <span class="n">independent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ito</span> <span class="o">=</span> <span class="n">ito</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span> <span class="o">=</span> <span class="n">process_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comments</span> <span class="o">=</span> <span class="n">default_comments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_wrong_params</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_with_differential</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external_simulator</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_main&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increment_process</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_increment_process</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the process.</span>

<span class="sd">        :return: The name of the process</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the name of the process.</span>

<span class="sd">        :param new_name: The new name of the process</span>
<span class="sd">        :type new_name: str</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">new_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">multiplicative</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the multiplicative property of the process.</span>
<span class="sd">        It shows if the process is multiplicative.</span>

<span class="sd">        :return: The multiplicative property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">independent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the independent property of the process.</span>
<span class="sd">        It shows if the increments of the process are independent.</span>

<span class="sd">        :return: The independent property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ito</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Ito property of the process.</span>
<span class="sd">        It shows if the process is an Ito process/</span>

<span class="sd">        :return: The Ito property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ito</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">comments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the comments property of the process.</span>
<span class="sd">        It is used to display comments about the process when the code runs.</span>

<span class="sd">        :return: The comments property of the process.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comments</span>

    <span class="nd">@comments</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">comments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the comments property of the process.</span>
<span class="sd">        It is used to display comments about the process when the code runs.</span>

<span class="sd">        :param value: The new value of the comments property</span>
<span class="sd">        :type value: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        :raises ValueError: If the value is not a boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Comments must be a boolean value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comments</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Process.get_comments">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.get_comments">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_comments</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the comments property of the process.</span>
<span class="sd">        This is a class method. It means that it is a method that is called on the class itself, not on an instance of the class.</span>

<span class="sd">        :return: The comments property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_comments</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">process_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the process class of the process.</span>
<span class="sd">        Here, the process class is the class in the stochastic library that corresponds to the process.</span>
<span class="sd">        It has nothing to do with the Process class itself (inside the Ergodicity Library).</span>

<span class="sd">        :return: The process class of the process</span>
<span class="sd">        :rtype: Type[Any]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_wrong_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the has_wrong_params property of the process.</span>
<span class="sd">        It shows if the corresponding process in the stochastic library has parameters in an unexpected format that must be corrected.</span>

<span class="sd">        :return: The has_wrong_params property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_wrong_params</span>

    <span class="nd">@has_wrong_params</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">has_wrong_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the has_wrong_params property of the process.</span>

<span class="sd">        :param value: Whether the process has wrong parameters</span>
<span class="sd">        :type value: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_wrong_params</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the custom property of the process.</span>
<span class="sd">        It shows if the process is a custom process (and not a standard process from the library).</span>

<span class="sd">        :return: The custom property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">simulate_with_differential</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the simulate_with_differential property of the process.</span>
<span class="sd">        It sets if the process is simulated using differential methods.</span>
<span class="sd">        If it is False, the process is simulated using relevant probability distribution.</span>

<span class="sd">        :return: The simulate_with_differential property of the process</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_with_differential</span>

    <span class="nd">@simulate_with_differential</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">simulate_with_differential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the simulate_with_differential property of the process.</span>

<span class="sd">        :param value: Whether the process is simulated using differential methods</span>
<span class="sd">        :type value: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_with_differential</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the output directory of the process.</span>
<span class="sd">        It is the directory where the process results are saved.</span>

<span class="sd">        :return: The output directory of the process</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span>

    <span class="nd">@output_dir</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the output directory of the process.</span>

<span class="sd">        :param new_output_dir: The new output directory of the process</span>
<span class="sd">        :type new_output_dir: str</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="o">=</span> <span class="n">new_output_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the types of the process.</span>
<span class="sd">        The types are used to categorize the process. They are custom labels that can be used to identify the process.</span>

<span class="sd">        :return: The types of the process</span>
<span class="sd">        :rtype: List[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_types</span>

    <span class="nd">@types</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the types of the process.</span>

<span class="sd">        :param new_types:  The new types of the process</span>
<span class="sd">        :type new_types: List[str]</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        :raises ValueError: If the types are not a list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Types must be a list of strings.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_types</span> <span class="o">=</span> <span class="n">new_types</span>

<div class="viewcode-block" id="Process.add_type">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.add_type">[docs]</a>
    <span class="k">def</span> <span class="nf">add_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new type to the types list if it is not already present.</span>

<span class="sd">        :param new_type: The new type to add</span>
<span class="sd">        :type new_type: str</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The type &#39;</span><span class="si">{</span><span class="n">new_type</span><span class="si">}</span><span class="s2">&#39; is already present in the list.&quot;</span><span class="p">)</span></div>


    <span class="n">always_present_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplicative&#39;</span><span class="p">,</span> <span class="s1">&#39;ito&#39;</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="s1">&#39;process_class&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Process.get_params">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.get_params">[docs]</a>
    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves parameters specific to the current process class, excluding always_present_keys.</span>
<span class="sd">        This is usually needed when creating methods and functions than need to work for an arbitrary process class.</span>
<span class="sd">        For the end user, the method is usually not needed.</span>

<span class="sd">        :return: The process-specific parameters of the process</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">always_present_keys</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span></div>



<div class="viewcode-block" id="Process.correct_params">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.correct_params">[docs]</a>
    <span class="k">def</span> <span class="nf">correct_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct the parameters for the process.</span>
<span class="sd">        This method fixes some unintended behaviour of the stochastic library which is present for some classes.</span>
<span class="sd">        It is not needed for the end user.</span>

<span class="sd">        :param params: The parameters to correct</span>
<span class="sd">        :type params: dict</span>
<span class="sd">        :param t: The total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :return: The corrected parameters</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_wrong_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;drift&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_has_wrong_params</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_drift</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">params</span></div>


<div class="viewcode-block" id="Process.data_for_simulation">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.data_for_simulation">[docs]</a>
    <span class="k">def</span> <span class="nf">data_for_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the data for simulation.</span>
<span class="sd">        This is an intermediate method that is further used in the simulate method which is already used by the user.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :return: The number of steps, the times, and the data</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_instances</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">num_steps</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">data</span></div>


<div class="viewcode-block" id="Process.custom_increment">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.custom_increment">[docs]</a>
    <span class="k">def</span> <span class="nf">custom_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom increment function for the process.</span>
<span class="sd">        This method simulates a discrete approximation of the increment (differential) of the process.</span>

<span class="sd">        :param X: The current value of the process</span>
<span class="sd">        :type X: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :return: The increment of the process</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="Process.separate">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.separate">[docs]</a>
    <span class="k">def</span> <span class="nf">separate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Separate the discrete time moments and corresponding process data in the dataset typically generated by many methods in the Ergodicity Library.</span>
<span class="sd">        It is usually needed if you need to extract simulated data without time moments, or just time moments, if you need to plot the data, or if you need to pass the data to a custom method.</span>
<span class="sd">        It returns the times and the data as arrays.</span>

<span class="sd">        :param data: The data to separate</span>
<span class="sd">        :type data: Any</span>
<span class="sd">        :return: The times and the data</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">times</span><span class="p">,</span> <span class="n">data</span></div>


<div class="viewcode-block" id="Process.memory_update">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.memory_update">[docs]</a>
    <span class="k">def</span> <span class="nf">memory_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the memory of the process. Used in the construction of processes with memory.</span>

<span class="sd">        :param step: The current step</span>
<span class="sd">        :type step: int</span>
<span class="sd">        :return: The updated memory</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.custom_simulate_raw">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.custom_simulate_raw">[docs]</a>
    <span class="k">def</span> <span class="nf">custom_simulate_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                    <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">X0</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the process using a custom simulation method. It is an intermediate method that is further used in the simulate method which is already used by the user.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param X0: Initial value for the process</span>
<span class="sd">        :type X0: float</span>
<span class="sd">        :return: The simulated data of shape (num_instances + 1, num_steps)</span>
<span class="sd">        :rtype: NumPy array of shape (num_instances + 1, num_steps)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num_steps</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_for_simulation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_increment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">X0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">X0</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">and</span> <span class="n">X0</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You have selected a negative or zero initial value for a multiplicative process. It is likely that it is done by mistake. We recommend to change the initial value to a positive value.&quot;</span><span class="p">,</span> <span class="n">KnowWhatYouDoWarning</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
                    <span class="n">dX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_increment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_update</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">dX</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">)</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The process has reached a negative value. The simulation will continue with a very small positive value. It may impact the results of the simulation in an unexpected or unintended way. We recommend to decrease the timestep to avoid this issue.&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulating instance </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">, X = </span><span class="si">{</span><span class="n">X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">times</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="Process.simulate_until">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_until">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_until</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">X0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the process until a certain condition is reached.</span>

<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param X0: Initial value for the process</span>
<span class="sd">        :type X0: float</span>
<span class="sd">        :param condition: The condition to reach</span>
<span class="sd">        :type condition: Callable[..., bool]</span>
<span class="sd">        :param save: Whether to save the simulation results</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the simulation results</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: The simulated data</span>
<span class="sd">        :rtype: NumPy array of shape (num_instances + 1, num_steps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_instances</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">X</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_increment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">X0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">X</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">X0</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">and</span> <span class="n">X0</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You have selected a negative or zero initial value for a multiplicative process. It is likely that it is done by mistake. We recommend to change the initial value to a positive value.&quot;</span><span class="p">,</span> <span class="n">KnowWhatYouDoWarning</span><span class="p">)</span>
                <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">condition</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
                    <span class="c1"># if step &gt;= data.shape[1]:</span>
                    <span class="c1">#     new_shape = (data.shape[0], step + 1)</span>
                    <span class="c1">#     data = np.resize(data, new_shape)</span>

                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span><span class="o">*</span><span class="n">timestep</span>

                    <span class="n">dX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_increment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_update</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">dX</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">X</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">X</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">)</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                                <span class="s2">&quot;The process has reached a negative value. The simulation will continue with a very small positive value. It may impact the results of the simulation in an unexpected or unintended way. We recommend to decrease the timestep to avoid this issue.&quot;</span><span class="p">,</span>
                                <span class="ne">UserWarning</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulating instance </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">, X = </span><span class="si">{</span><span class="n">X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># data_raw, times = self.separate(data)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_full</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="Process.save_to_file">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.save_to_file">[docs]</a>
    <span class="k">def</span> <span class="nf">save_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the data to a file.</span>

<span class="sd">        :param data: The data to save</span>
<span class="sd">        :type data: Any</span>
<span class="sd">        :param file_name: The name of the file</span>
<span class="sd">        :type file_name: str</span>
<span class="sd">        :param save: Whether to save the file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        :exception Exception: If the file is created but empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(f&quot;Debug: Entering save_to_file method&quot;)</span>
        <span class="c1"># print(f&quot;Debug: save parameter: {save}&quot;)</span>
        <span class="c1"># print(f&quot;Debug: file_name: {file_name}&quot;)</span>
        <span class="c1"># print(f&quot;Debug: data shape: {data.shape}&quot;)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># print(f&quot;Debug: Attempting to save file to: {full_path}&quot;)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># First, try to save using numpy&#39;s savetxt</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="c1"># print(f&quot;Data saved to {full_path} using np.savetxt&quot;)</span>

                <span class="c1"># Verify that the file is not empty</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File was created but is empty&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># print(f&quot;Error saving file with np.savetxt: {str(e)}&quot;)</span>
                <span class="c1"># print(&quot;Attempting to save with csv writer...&quot;)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># If numpy&#39;s savetxt fails, try using csv writer</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="c1"># print(f&quot;Data saved to {full_path} using csv writer&quot;)</span>

                    <span class="c1"># Verify that the file is not empty</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File was created but is empty&quot;</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file with csv writer: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Debug: Printing first few rows of data:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># Print first 5 rows of data</span>

            <span class="c1"># finally:</span>
            <span class="c1">#     # Check if the file exists and its size</span>
            <span class="c1">#     if os.path.exists(full_path):</span>
            <span class="c1">#         print(f&quot;File size: {os.path.getsize(full_path)} bytes&quot;)</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         print(&quot;File does not exist after save attempt&quot;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(&quot;Debug: save is False, not saving file&quot;)</span>
            <span class="k">pass</span></div>

        <span class="c1"># print(&quot;Debug: Exiting save_to_file method&quot;)</span>

<div class="viewcode-block" id="Process.plot">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_full</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">average_and_max</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">plotlog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the simulation results.</span>

<span class="sd">        :param data_full: The full data to plot</span>
<span class="sd">        :type data_full: Any</span>
<span class="sd">        :param num_instances: The number of instances to plot</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the data</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :param average_and_max: Whether to plot the average and max values</span>
<span class="sd">        :type average_and_max: bool</span>
<span class="sd">        :param plotlog: Whether to plot the data on a logarithmic scale</span>
<span class="sd">        :type plotlog: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">timestep</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">average_and_max</span><span class="p">:</span>
                <span class="c1"># Visualization</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">plotlog</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Apply logarithmic scale for y-axis if plotlog is True</span>

                <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">_process_simulation.png&#39;</span><span class="p">))</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Calculate average and max values at each time point</span>
                <span class="n">avg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">max_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Visualization</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

                <span class="c1"># Plot individual instances with faint lines</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>  <span class="c1"># Fainter color and lower alpha</span>

                <span class="c1"># Plot average and max values with stronger visibility</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">avg_data</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Average&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>  <span class="c1"># Thicker line for average</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">max_data</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>  <span class="c1"># Thicker line for max</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">plotlog</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Apply logarithmic scale for y-axis if plotlog is True</span>

                <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span>
                                             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">_process_simulation.png&#39;</span><span class="p">))</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Process.simulate">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">average_and_max</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plotlog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">X0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the process using the given stochastic process class.</span>
<span class="sd">        A general and widely used method that is used to simulate the process.</span>
<span class="sd">        It uses several intermediate methods defined before.</span>
<span class="sd">        Many functions and methods rely on this method.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the results</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :param average_and_max: Whether to plot the average and max values</span>
<span class="sd">        :type average_and_max: bool</span>
<span class="sd">        :param plotlog: Whether to plot the data on a logarithmic scale</span>
<span class="sd">        :type plotlog: bool</span>
<span class="sd">        :param X0: Initial value for the process</span>
<span class="sd">        :type X0: float</span>
<span class="sd">        :return: Simulated data array of shape (num_instances + 1, num_steps) where the first row is time and the rest are process values</span>
<span class="sd">        :rtype: NumPy array of shape (num_instances + 1, num_steps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correct_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">(),</span> <span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_external_simulator</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)):</span>

            <span class="k">if</span> <span class="n">X0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InDevelopmentWarning</span><span class="p">(</span><span class="s1">&#39;Initial value X0 is not supported for external simulators.&#39;</span>
                                           <span class="s1">&#39;Please either use an internal simulator or do not use an initial value.&#39;</span>
                                           <span class="s1">&#39;For external simulators, the initial value is set 0 for additivive process and 1 for multiplicative processes, and cannot be changed.&#39;</span><span class="p">)</span>

            <span class="n">num_steps</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_for_simulation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>

            <span class="n">process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">1000000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulating instance </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

            <span class="c1"># add times as the first row</span>
            <span class="n">data_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">times</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom_simulate_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_simulate_raw</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">X0</span><span class="o">=</span><span class="n">X0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">custom_simulate_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_has_wrong_params</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">data_full</span> <span class="o">=</span> <span class="n">custom_simulate_value</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The process must be simulated using either an external simulator or a custom simulation method. For this process, neither is available.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;process_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">average_and_max</span><span class="o">=</span><span class="n">average_and_max</span><span class="p">,</span> <span class="n">plotlog</span><span class="o">=</span><span class="n">plotlog</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_full</span></div>


<div class="viewcode-block" id="Process.simulate_ensembles">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_ensembles">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_ensembles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                           <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">num_ensembles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_ensembles_default</span><span class="p">,</span>
                           <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot_separate_ensembles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">X0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate multiple ensembles of the process and visualize the results.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param num_ensembles: Number of ensembles to simulate</span>
<span class="sd">        :type num_ensembles: int</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the results</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :param plot_separate_ensembles: Whether to plot the separate ensembles</span>
<span class="sd">        :type plot_separate_ensembles: bool</span>
<span class="sd">        :param X0: Initial value for the process</span>
<span class="sd">        :type X0: float</span>
<span class="sd">        :return: The ensemble simulation data and the total average</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="n">ensemble</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_ensembles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">))</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">)</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">times</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ensembles</span><span class="p">):</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X0</span><span class="o">=</span><span class="n">X0</span><span class="p">)</span>
            <span class="n">averages</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Check the shape of averages and adjust if necessary</span>
            <span class="k">if</span> <span class="n">averages</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">):</span>
                <span class="c1"># If averages has shape (2, num_steps), take the second row</span>
                <span class="n">averages</span> <span class="o">=</span> <span class="n">averages</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">elif</span> <span class="n">averages</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">num_steps</span><span class="p">,):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unexpected shape of averages: </span><span class="si">{</span><span class="n">averages</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">. Expected (</span><span class="si">{</span><span class="n">num_steps</span><span class="si">}</span><span class="s2">,) or (2, </span><span class="si">{</span><span class="n">num_steps</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="n">ensemble</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">averages</span>

        <span class="n">total_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="c1"># visualize all paths of averages as well as total average</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plot_separate_ensembles</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_ensembles</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">total_average</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ensemble Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">_num_ensembles:</span><span class="si">{</span><span class="n">num_ensembles</span><span class="si">}</span><span class="s1">_process_simulation.png&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ensemble</span><span class="p">,</span> <span class="n">total_average</span></div>


<div class="viewcode-block" id="Process.simulate_weights">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_weights">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                         <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the weights (relative shares) of the process instances in the ensemble.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the results</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: Array of simulated weights</span>
<span class="sd">        :rtype: NumPy array of shape (num_instances + 1, num_steps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simulate the process</span>
        <span class="n">data_full</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Extract times and process values</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">process_values</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span><span class="p">:</span>
            <span class="c1"># For multiplicative processes, weights are directly proportional to the process values</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">process_values</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">process_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For non-multiplicative processes, we need to handle potential negative values</span>
            <span class="c1"># We&#39;ll use the softmax function to ensure positive weights</span>
            <span class="n">exp_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">process_values</span><span class="p">)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">exp_values</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exp_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Combine times and weights</span>
        <span class="n">weight_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">times</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;weights_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;weight_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)])</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">weight_data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weights saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_weights</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">weight_data</span></div>


<div class="viewcode-block" id="Process.plot_weights">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot_weights">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">save</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the simulated weights.</span>

<span class="sd">        :param times: Array of time values</span>
<span class="sd">        :type times: np.ndarray</span>
<span class="sd">        :param weights: Array of simulated weights</span>
<span class="sd">        :type weights: np.ndarray</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Weight </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Weight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Simulated Weights&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weights_plot_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Process.simulate_2d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_2d">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                    <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate a 2D process by combining two 1D simulations.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the simulation results</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the simulation results</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: Simulated 2D data array</span>
<span class="sd">        :rtype: NumPy array of shape (2 * num_instances + 1, num_steps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simulate two 1D processes</span>
        <span class="n">data_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Extract time values</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Combine the two 1D simulations into a 2D simulation</span>
        <span class="n">data_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)))</span>
        <span class="n">data_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">times</span>  <span class="c1"># First row is time</span>
        <span class="n">data_2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># X dimension</span>
        <span class="n">data_2d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># Y dimension</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;process_simulation_2d_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_2d</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_2dt</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_2d</span></div>


<div class="viewcode-block" id="Process.plot_2d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot_2d">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_2d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the 2D simulation results.</span>

<span class="sd">        :param data_2d: 2D simulation data</span>
<span class="sd">        :type data_2d: np.ndarray</span>
<span class="sd">        :param num_instances: Number of instances simulated</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to display the plot</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">times</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2D Process Simulation (t=</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, timestep=</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, instances=</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X dimension&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y dimension&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2d_simulation_plot_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Process.plot_2dt">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot_2dt">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_2dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_2d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the 2D simulation results in a 3D graph with time as the third dimension.</span>

<span class="sd">        :param data_2d: 2D simulation data</span>
<span class="sd">        :type data_2d: np.ndarray</span>
<span class="sd">        :param num_instances: Number of instances simulated</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to display the plot</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">times</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">times</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;3D Visualization of 2D Process Simulation</span><span class="se">\n</span><span class="s2">(t=</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, timestep=</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, instances=</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3d_simulation_plot_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Process.simulate_3d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_3d">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                    <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate a 3D process by combining three 1D simulations.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the simulation results</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the simulation results</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: Simulated 3D data array</span>
<span class="sd">        :rtype: NumPy array of shape (3 * num_instances + 1, num_steps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simulate three 1D processes</span>
        <span class="n">data_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Extract time values</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Combine the three 1D simulations into a 3D simulation</span>
        <span class="n">data_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)))</span>
        <span class="n">data_3d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">times</span>  <span class="c1"># First row is time</span>
        <span class="n">data_3d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># X dimension</span>
        <span class="n">data_3d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># Y dimension</span>
        <span class="n">data_3d</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data_z</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># Z dimension</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;process_simulation_3d_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_3d</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_3d</span><span class="p">(</span><span class="n">data_3d</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_3d</span></div>


<div class="viewcode-block" id="Process.plot_3d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot_3d">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_3d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the 3D simulation results.</span>

<span class="sd">        :param data_3d: 3D simulation data</span>
<span class="sd">        :type data_3d: np.ndarray</span>
<span class="sd">        :param num_instances: Number of instances simulated</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to display the plot</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">times</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">z_data</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">z_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;3D Process Simulation</span><span class="se">\n</span><span class="s2">(t=</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, timestep=</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, instances=</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3d_simulation_plot_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Process.get_data_for_moments">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.get_data_for_moments">[docs]</a>
    <span class="k">def</span> <span class="nf">get_data_for_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">t_m</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">timestep_m</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">num_instances_m</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data for moments calculation. If the data was already pre-computed and passed to the method, it will be used.</span>
<span class="sd">        Else, the data will be simulated using the specified parameters.</span>
<span class="sd">        Note that if you pass the data and simultaneously define the parameters, the parameters will be ignored, and the data will be used.</span>

<span class="sd">        :param data: The data array of the process.</span>
<span class="sd">        :type data: Any</span>
<span class="sd">        :param t_m: Total time for the simulation.</span>
<span class="sd">        :type t_m: float</span>
<span class="sd">        :param timestep_m: Time step for the simulation.</span>
<span class="sd">        :type timestep_m: float</span>
<span class="sd">        :param num_instances_m: Number of instances to simulate.</span>
<span class="sd">        :type num_instances_m: int</span>
<span class="sd">        :return: The data array for moments calculation.</span>
<span class="sd">        :rtype: NumPy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t_m</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep_m</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances_m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="Process.moments">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.moments">[docs]</a>
    <span class="k">def</span> <span class="nf">moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">num_instances</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the cumulative moments of the process up to every point in time using an optimized iterative approach.</span>

<span class="sd">        :param data: The data array of the process.</span>
<span class="sd">        :type data: Any</span>
<span class="sd">        :param save: Whether to save the results to a file.</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param t: Total time for the simulation.</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation.</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate.</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :return: A tuple of times and the calculated moments (mean, variance, skewness, kurtosis, etc.</span>
<span class="sd">        :rtype: Tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_for_moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">t_m</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep_m</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances_m</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span><span class="p">:</span>
            <span class="n">data_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data_raw</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">data_raw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">timestep</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">cum_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
        <span class="n">cum_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
        <span class="n">cum_m3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
        <span class="n">cum_m4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
        <span class="n">cum_mad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_paths</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_times</span><span class="p">):</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                <span class="n">delta1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">t</span>
                <span class="n">delta2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">t</span>

                <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="n">current_value</span> <span class="o">*</span> <span class="n">delta1</span>
                <span class="n">cum_var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="p">((</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta1</span>
                <span class="n">cum_m3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_m3</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="p">((</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span> <span class="o">**</span> <span class="mi">3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">delta1</span>
                <span class="n">cum_m4</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_m4</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="p">((</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta1</span>
                <span class="n">cum_mad</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_mad</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">cum_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span> <span class="o">*</span> <span class="n">delta1</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cum_mean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">timestep</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cum_var</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">timestep</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cum_m3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">cum_var</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cum_m4</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">cum_var</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cum_mad</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">timestep</span> <span class="o">**</span> <span class="mf">0.5</span>

        <span class="n">data_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">kurtosis</span><span class="p">,</span> <span class="n">mad</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;moments_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">times</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">kurtosis</span><span class="p">,</span> <span class="n">mad</span></div>


<div class="viewcode-block" id="Process.k_moments">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.k_moments">[docs]</a>
    <span class="k">def</span> <span class="nf">k_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                          <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">visualize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the cumulative moments of the process up to a specified order for every point in time</span>
<span class="sd">        using an optimized iterative approach.</span>

<span class="sd">        :param data: The data array of the process.</span>
<span class="sd">        :type data: Any</span>
<span class="sd">        :param order: The maximum order of moments to calculate.</span>
<span class="sd">        :type order: int</span>
<span class="sd">        :param save: Whether to save the results to a file.</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param t: Total time for the simulation.</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation.</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate.</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :return: A tuple of times and the calculated moments (mean, variance, skewness, kurtosis, etc.).</span>
<span class="sd">        :rtype: Tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_for_moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">t_m</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep_m</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances_m</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span><span class="p">:</span>
            <span class="n">data_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data_raw</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">data_raw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">timestep</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Initialize arrays to store cumulative moments</span>
        <span class="n">cum_moments</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_paths</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">)]</span>

        <span class="c1"># First moment (mean)</span>
        <span class="n">cum_moments</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_paths</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_times</span><span class="p">):</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                <span class="n">delta1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">t</span>
                <span class="n">delta2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">t</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">cum_moments</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_moments</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="n">current_value</span> <span class="o">*</span> <span class="n">delta1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cum_moments</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">cum_moments</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta2</span> <span class="o">+</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">cum_moments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">delta1</span>

        <span class="c1"># Convert cumulative moments to actual moments</span>
        <span class="n">moments</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cum_moments</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">timestep</span> <span class="o">**</span> <span class="p">(</span><span class="n">k</span> <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">)]</span>

        <span class="c1"># Adjust moments if necessary (e.g., skewness, kurtosis)</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">moments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">moments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># Skewness</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">moments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">moments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># Kurtosis</span>

        <span class="c1"># Compile data into a single array</span>
        <span class="n">data_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">+</span> <span class="n">moments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span>
                              <span class="sa">f</span><span class="s2">&quot;moments_simulation_order_</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                              <span class="n">save</span><span class="p">)</span>
        <span class="c1"># remove the first element of times</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_moment</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">moments</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;moment_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_default</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="o">*</span><span class="n">moments</span><span class="p">)</span></div>


<div class="viewcode-block" id="Process.plot_moment">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot_moment">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">moment</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize a given moment of the process - a helper function for the next methods.</span>

<span class="sd">        :param times: The times at which the process is sampled</span>
<span class="sd">        :type times: np.ndarray</span>
<span class="sd">        :param moment: The moment to plot</span>
<span class="sd">        :type moment: np.ndarray</span>
<span class="sd">        :param label: The label of the moment</span>
<span class="sd">        :type label: str</span>
<span class="sd">        :param mask: The mask to apply to the data</span>
<span class="sd">        :type mask: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">mask</span><span class="p">:]</span>
        <span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span><span class="p">[</span><span class="n">mask</span><span class="p">:]</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">moment</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">_of_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_simulation.png&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Process.moments_dict">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.moments_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">moments_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">num_instances</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a dictionary to further calculate the first, the second, the third, and the fourth moments of the process.</span>

<span class="sd">        :param data: The data array of the process</span>
<span class="sd">        :type data: NumPy array</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :return: A dictionary of moments where the keys are the moment names and the values are the calculated moments</span>
<span class="sd">        :rtype: Dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">kurtosis</span><span class="p">,</span> <span class="n">mad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Mean&quot;</span><span class="p">:</span> <span class="n">mean</span><span class="p">,</span> <span class="s2">&quot;Variance&quot;</span><span class="p">:</span> <span class="n">variance</span><span class="p">,</span> <span class="s2">&quot;Skewness&quot;</span><span class="p">:</span> <span class="n">skewness</span><span class="p">,</span> <span class="s2">&quot;Kurtosis&quot;</span><span class="p">:</span> <span class="n">kurtosis</span><span class="p">,</span> <span class="s2">&quot;Mean Absolute Deviation&quot;</span><span class="p">:</span> <span class="n">mad</span><span class="p">}</span></div>


<div class="viewcode-block" id="Process.visualize_moments">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.visualize_moments">[docs]</a>
    <span class="k">def</span> <span class="nf">visualize_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">num_instances</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize the first, the second, the third, and the fourth moments of the process.</span>

<span class="sd">        :param times: The times at which the process is sampled</span>
<span class="sd">        :type times: np.ndarray</span>
<span class="sd">        :param data: The data array of the process</span>
<span class="sd">        :type data: NumPy array</span>
<span class="sd">        :param mask: The mask to apply to the data</span>
<span class="sd">        :type mask: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_for_moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">t_m</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep_m</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances_m</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">moments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moments_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">moment</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_moment</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">moments</span><span class="p">[</span><span class="n">moment</span><span class="p">],</span> <span class="n">moment</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">moments</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;moments_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span></div>


<div class="viewcode-block" id="Process.visualize_moment">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.visualize_moment">[docs]</a>
    <span class="k">def</span> <span class="nf">visualize_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">num_instances</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize a given moment of the process - a helper function for the next methods.</span>

<span class="sd">        :param data: The data array of the process</span>
<span class="sd">        :type data: NumPy array</span>
<span class="sd">        :param label: The label of the moment</span>
<span class="sd">        :type label: str</span>
<span class="sd">        :param mask: The mask to apply to the data</span>
<span class="sd">        :type mask: int</span>
<span class="sd">        :param save: Whether to save the plot</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_for_moments</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">t_m</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep_m</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances_m</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">moments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moments_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_moment</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">moments</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">moments</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span></div>


<div class="viewcode-block" id="Process.simulate_live">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_live">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_live</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the process live and save as a video file.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the simulation data</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param speed: Speed multiplier for the video (default is 1.0, higher values make the video faster)</span>
<span class="sd">        :type speed: float</span>
<span class="sd">        :return: Video file of the simulation</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">num_steps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">times</span><span class="p">[:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="c1"># Calculate fps based on the desired speed</span>
        <span class="n">fps</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">timestep</span><span class="p">)</span> <span class="o">*</span> <span class="n">speed</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">fps</span>  <span class="c1"># interval in milliseconds</span>

        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_simulation_with_parameters_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">.mp4&#39;</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;liv_process_simulation_with_parameters_{self.get_params()}_t:</span><span class="si">{t}</span><span class="s2">_timestep:</span><span class="si">{timestep}</span><span class="s2">_num_instances:</span><span class="si">{num_instances}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_simulation.mp4&#39;</span></div>


<div class="viewcode-block" id="Process.simulate_live_2d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_live_2d">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_live_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                         <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the 2D process live and save as a video file.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the simulation data</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param speed: Speed multiplier for the video (default is 1.0, higher values make the video faster)</span>
<span class="sd">        :type speed: float</span>
<span class="sd">        :return: Video file name of the simulation</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :exception: CalledProcessError if the video cannot be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_2d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="n">num_steps</span> <span class="o">=</span> <span class="n">data_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;2D Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="c1"># Calculate fps based on the desired speed</span>
        <span class="n">fps</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">timestep</span><span class="p">)</span> <span class="o">*</span> <span class="n">speed</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">fps</span>  <span class="c1"># interval in milliseconds</span>

        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">video_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_2d_simulation_with_parameters_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">.mp4&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">video_filename</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">extra_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-pix_fmt&#39;</span><span class="p">,</span> <span class="s1">&#39;yuv420p&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2D simulation video saved as </span><span class="si">{</span><span class="n">video_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving 2D simulation video: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_2d_simulation_with_parameters_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">video_filename</span></div>


<div class="viewcode-block" id="Process.simulate_live_3d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_live_3d">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_live_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                         <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the 3D process live and save as a video file.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the simulation data</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param speed: Speed multiplier for the video (default is 1.0, higher values make the video faster)</span>
<span class="sd">        :type speed: float</span>
<span class="sd">        :return: Video file name of the simulation</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :exception: CalledProcessError if the video cannot be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_3d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">z_data</span> <span class="o">=</span> <span class="n">data_3d</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="n">num_steps</span> <span class="o">=</span> <span class="n">data_3d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;3D Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z dimension&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">([])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="c1"># Calculate fps based on the desired speed</span>
        <span class="n">fps</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">timestep</span><span class="p">)</span> <span class="o">*</span> <span class="n">speed</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">fps</span>  <span class="c1"># interval in milliseconds</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">z_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="c1"># ax.view_init(30, 0.3 * frame * speed)  # Rotate view for 3D effect, adjusted for speed</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">video_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_3d_simulation_with_parameters_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">.mp4&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">video_filename</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">extra_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-pix_fmt&#39;</span><span class="p">,</span> <span class="s1">&#39;yuv420p&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3D simulation video saved as </span><span class="si">{</span><span class="n">video_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving 3D simulation video: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_3d</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_3d_simulation_with_parameters_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">save</span><span class="p">)</span>

        <span class="c1"># Create Plotly Scatter3D trace for the simulation path</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">z</span><span class="o">=</span><span class="n">z_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">))</span>

        <span class="c1"># Create Plotly figure</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Create a colormap to assign colors to each instance</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>  <span class="c1"># Or any other colormap you prefer</span>

        <span class="c1"># Add a Scatter3D trace for each instance with unique color</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">num_instances</span><span class="p">)</span>  <span class="c1"># Get a color from the colormap</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">z</span><span class="o">=</span><span class="n">z_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;rgb</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">color</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>  <span class="c1"># Convert color to RGB string</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Instance </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># Add a name for the legend</span>
            <span class="p">))</span>

        <span class="c1"># Show figure (optional)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Save as interactive HTML file</span>
        <span class="n">object_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_3d_object_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">.html&#39;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">object_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3D object saved as </span><span class="si">{</span><span class="n">object_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">video_filename</span><span class="p">,</span> <span class="n">object_filename</span></div>


<div class="viewcode-block" id="Process.simulate_live_2dt">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_live_2dt">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_live_2dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span>
                                   <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the 2D process live with time as the third dimension and save as a video file and interactive plot.</span>

<span class="sd">        :param t: Total time for the simulation</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: Time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate (default is 2)</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the simulation data</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param speed: Speed multiplier for the video (default is 1.0, higher values make the video faster)</span>
<span class="sd">        :type speed: float</span>
<span class="sd">        :return: Tuple of video file name and interactive plot file name</span>
<span class="sd">        :rtype: Tuple</span>
<span class="sd">        :exception: CalledProcessError if the video cannot be saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_2d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">num_instances</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="n">num_steps</span> <span class="o">=</span> <span class="n">data_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;2D Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> with Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y dimension&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">([])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="n">fps</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">timestep</span><span class="p">)</span> <span class="o">*</span> <span class="n">speed</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">fps</span>  <span class="c1"># interval in milliseconds</span>

        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_3d_properties</span><span class="p">(</span><span class="n">times</span><span class="p">[:</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">video_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_2d_time_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s1">.mp4&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">video_filename</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;ffmpeg&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s1">&#39;libx264&#39;</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">extra_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-pix_fmt&#39;</span><span class="p">,</span> <span class="s1">&#39;yuv420p&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2D with time simulation video saved as </span><span class="si">{</span><span class="n">video_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving 2D with time simulation video: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_2d_time_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">_num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="c1"># Create Plotly figure</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Create a colormap to assign colors to each instance</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>  <span class="c1"># Or any other colormap you prefer</span>

        <span class="c1"># Add a Scatter3d trace for each instance with unique color</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">num_instances</span><span class="p">)</span>  <span class="c1"># Get a color from the colormap</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">z</span><span class="o">=</span><span class="n">times</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;rgb</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">255</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">color</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>  <span class="c1"># Convert color to RGB string</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Instance </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># Add a name for the legend</span>
            <span class="p">))</span>

        <span class="c1"># Update layout for better visibility</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;X dimension&#39;</span><span class="p">,</span>
                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Y dimension&#39;</span><span class="p">,</span>
                <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                <span class="n">aspectmode</span><span class="o">=</span><span class="s1">&#39;manual&#39;</span><span class="p">,</span>
                <span class="n">aspectratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;2D Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> with Time&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Show figure (optional)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Save as interactive HTML file</span>
        <span class="n">object_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_2d_time_object_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">_timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">.html&#39;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">object_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2D with time object saved as </span><span class="si">{</span><span class="n">object_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">video_filename</span><span class="p">,</span> <span class="n">object_filename</span></div>


<div class="viewcode-block" id="Process.increment_intermediate">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.increment_intermediate">[docs]</a>
    <span class="k">def</span> <span class="nf">increment_intermediate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep_increment</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the increment of the process for a given timestep increment.</span>
<span class="sd">        This method is used as an intermediate step for the increment method.</span>

<span class="sd">        :param timestep_increment: The timestep increment for the process</span>
<span class="sd">        :type timestep_increment: float</span>
<span class="sd">        :return: The increment of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">increment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_increment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">timestep_increment</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">timestep_increment</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>
            <span class="n">increment</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">increment</span></div>


<div class="viewcode-block" id="Process.increment">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.increment">[docs]</a>
    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep_increment</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the increment of the process for a given timestep increment.</span>

<span class="sd">        :param timestep_increment: The timestep increment for the process</span>
<span class="sd">        :type timestep_increment: float</span>
<span class="sd">        :return: The increment of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicative</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The increments are not independent for this process. Constructing a process from such increments will not lead to a valid process. This method will return an increment for the default (initial) state of the process.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span>
            <span class="p">)</span>
        <span class="n">increment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment_intermediate</span><span class="p">(</span><span class="n">timestep_increment</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">increment</span></div>


<div class="viewcode-block" id="Process.ensemble_average">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.ensemble_average">[docs]</a>
    <span class="k">def</span> <span class="nf">ensemble_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the finite ensemble average of the process.</span>

<span class="sd">        :param num_instances: The number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: The ensemble average of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># select the last value of each instance</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># calculate the average</span>
        <span class="n">ensemble_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">ensemble_average</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;ensemble_average_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ensemble_average</span></div>


<div class="viewcode-block" id="Process.time_average">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.time_average">[docs]</a>
    <span class="k">def</span> <span class="nf">time_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the time average approximation of the process in a direct way (using one process instance and long simulation time).</span>

<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: The time average of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">time_average</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">/</span><span class="n">timestep</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">time_average</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;time_average_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">time_average</span></div>


    <span class="c1"># methods to calculate ensemble and time averages of growth rates</span>

<div class="viewcode-block" id="Process.growth_rate_ensemble_average">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.growth_rate_ensemble_average">[docs]</a>
    <span class="k">def</span> <span class="nf">growth_rate_ensemble_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the ensemble average of the growth rates of the process.</span>

<span class="sd">        :param num_instances: The number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: The ensemble average of the growth rates of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

            <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># calculate mean of the last column in data</span>
            <span class="n">ensemble_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Calculate the growth rate for each instance</span>
            <span class="n">ensemble_average_growth_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ensemble_average</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">ensemble_average_growth_rate</span><span class="p">,</span>
                              <span class="sa">f</span><span class="s2">&quot;growth_rate_ensemble_average_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                              <span class="n">save</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ensemble_average_growth_rate</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The ensemble average of growth rates can now only be calculated for multiplicative processes.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Process.growth_rate_time_average">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.growth_rate_time_average">[docs]</a>
    <span class="k">def</span> <span class="nf">growth_rate_time_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the time average of the growth rates of the process in a direct way (using one process instance and long simulation time).</span>

<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: The time average of the growth rates of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">last_element</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">growth_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">last_element</span><span class="p">)</span>
            <span class="n">growth_rate_over_time</span> <span class="o">=</span> <span class="n">growth_rate</span> <span class="o">/</span> <span class="n">t</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">growth_rate_over_time</span><span class="p">,</span>
                              <span class="sa">f</span><span class="s2">&quot;growth_rate_time_average_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                              <span class="n">save</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">growth_rate_over_time</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The time average of growth rates can now only be calculated for multiplicative processes.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Process.plot_growth_rate_of_average_3d">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.plot_growth_rate_of_average_3d">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_growth_rate_of_average_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_range</span><span class="p">,</span> <span class="n">time_range</span><span class="p">,</span> <span class="n">instance_step</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span>
                                    <span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;growth_rate_of_average_function&#39;</span><span class="p">,</span> <span class="n">save_html</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a 3D graph of average growth rate as a function of number of instances and time.</span>

<span class="sd">        :param instance_range: Tuple of (min_instances, max_instances)</span>
<span class="sd">        :type instance_range: Tuple</span>
<span class="sd">        :param time_range: Tuple of (min_time, max_time)</span>
<span class="sd">        :type time_range: Tuple</span>
<span class="sd">        :param instance_step: Step size for instances</span>
<span class="sd">        :type instance_step: float</span>
<span class="sd">        :param time_step: Step size for time</span>
<span class="sd">        :type time_step: float</span>
<span class="sd">        :param step_type: &#39;linear&#39; or &#39;logarithmic&#39;</span>
<span class="sd">        :type step_type: str</span>
<span class="sd">        :param filename: Path to save the results (if None, results won&#39;t be saved)</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        :param save_html: Whether to save the interactive 3D plot as an HTML file</span>
<span class="sd">        :type save_html: bool</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">*</span><span class="n">instance_range</span><span class="p">,</span> <span class="n">instance_step</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">*</span><span class="n">time_range</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">step_type</span> <span class="o">==</span> <span class="s1">&#39;logarithmic&#39;</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">instance_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">instance_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                    <span class="n">num</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="n">instance_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">instance_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">instance_step</span><span class="p">))</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">num</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">time_step</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;step_type must be either &#39;linear&#39; or &#39;logarithmic&#39;&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">num_instances</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instances</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_instances</span><span class="p">))</span>
                <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">growth_rate_of_average_per_time</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Create the 3D plot</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">instances</span><span class="p">)</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Instances&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Average Growth Rate&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Growth Rate vs. Number of Instances and Time&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.npy&#39;</span><span class="p">),</span> <span class="n">results</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Create and save interactive 3D plot using Plotly</span>
        <span class="k">if</span> <span class="n">save_html</span><span class="p">:</span>
            <span class="n">fig_plotly</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">instances</span><span class="p">)])</span>
            <span class="n">fig_plotly</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average Growth Rate vs. Number of Instances and Time&#39;</span><span class="p">,</span>
                                     <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                                                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Number of Instances&#39;</span><span class="p">,</span>
                                                <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Average Growth Rate&#39;</span><span class="p">))</span>

            <span class="n">html_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">_3d_growth_rate_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s1">_t:</span><span class="si">{</span><span class="n">time_range</span><span class="si">}</span><span class="s1">_instances:</span><span class="si">{</span><span class="n">instance_range</span><span class="si">}</span><span class="s1">.html&#39;</span>
            <span class="n">html_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span> <span class="n">html_filename</span><span class="p">)</span>
            <span class="n">fig_plotly</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">html_filename</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3D interactive graph saved as </span><span class="si">{</span><span class="n">html_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Process.simulate_distribution">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the probability distribution corresponding to the process.</span>

<span class="sd">        :param num_instances: The number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :param plot: Whether to plot the distribution</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: The distribution of the process represented as a histogram</span>
<span class="sd">        :rtype: Tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Take the last value of each instance</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Calculate the distribution</span>
        <span class="n">distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># plot the distribution</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Distribution of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;distribution_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;distribution_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">distribution</span></div>


<div class="viewcode-block" id="Process.relative_variance_pea">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.relative_variance_pea">[docs]</a>
    <span class="k">def</span> <span class="nf">relative_variance_pea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the relative variance of the process using the PEA method.</span>
<span class="sd">        It means that we simulate the process for a given time and calculate the relative variance of the process.</span>

<span class="sd">        :param num_instances: The number of instances of the process to use in the pea estimation</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param n: the number of instances to use in the estimation of the ensemble average as approximation of ensemble average (should be rather large)</span>
<span class="sd">        :type n: int</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: The relative variance of the process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

        <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Take the last value of each instance</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Calculate the relative variance</span>
        <span class="n">relative_variance</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">num_instances</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">relative_variance</span><span class="p">,</span>
                          <span class="sa">f</span><span class="s2">&quot;relative_variance_pea_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="si">}</span><span class="s2">, t:</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, timestep:</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s2">, num_instances:</span><span class="si">{</span><span class="n">num_instances</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
                          <span class="n">save</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">relative_variance</span></div>


<div class="viewcode-block" id="Process.self_averaging_time">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.self_averaging_time">[docs]</a>
    <span class="k">def</span> <span class="nf">self_averaging_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the self-averaging time of the process.</span>
<span class="sd">        Self-averaging time is the time after which the process ensemble starts to behave as a time average and stops behave as an ensemble average (so stops self-averaging).</span>
<span class="sd">        This method will work properly only if you select t that is long enough.</span>
<span class="sd">        We do not know any formal method to select t that is long enough for arbitrary process, so you have to check it by yourself.</span>

<span class="sd">        :param num_instances: The number of instances of the process to use in the pea estimation</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param n: the number of instances to use in the estimation of the ensemble average as approximation of ensemble average (should be rather large)</span>
<span class="sd">        :type n: int</span>
<span class="sd">        :param plot: Whether to plot the increments</span>
<span class="sd">        :type plot: bool</span>
<span class="sd">        :return: The empirical estimation of self-averaging time of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># times = times[:-1]</span>
        <span class="n">ensemble</span><span class="p">,</span> <span class="n">total_average</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate_ensembles</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span>
        <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances</span><span class="p">,</span> <span class="n">num_ensembles</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ensemble_average_simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ensemble_average</span> <span class="o">=</span> <span class="n">ensemble_average_simulation</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ensemble_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ensemble_average</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span><span class="p">:</span>
            <span class="n">ensemble_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ensemble_average</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">total_average</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplicative</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">total_average</span>

        <span class="c1"># calculate time average growth rate of data - last - first element divided by t</span>
        <span class="n">time_average_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">t</span>

        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># find the first element that is smaller than increment[0] - 0.5*difference</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">time_average_rate</span><span class="o">*</span><span class="n">current_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ensemble_average</span><span class="o">*</span><span class="n">current_time</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The self-averaging time could not be calculated. The time t may be too short for the process or the process is not subject to self-averaging breaking.&quot;</span><span class="p">)</span>

        <span class="c1"># merge times and increments and find time corresponding to the index (self-averaging time)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="n">self_averaging_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="c1"># plot the increments with vertical line at the self-averaging time</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Increments&#39;</span><span class="p">)</span>

            <span class="c1"># Ensure the self_averaging_time is within the data range</span>
            <span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">min_time</span> <span class="o">&lt;=</span> <span class="n">self_averaging_time</span> <span class="o">&lt;=</span> <span class="n">max_time</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">self_averaging_time</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Self-averaging time&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: self_averaging_time (</span><span class="si">{</span><span class="n">self_averaging_time</span><span class="si">}</span><span class="s2">) is outside the data time range.&quot;</span><span class="p">)</span>

            <span class="c1"># Set x-axis limits to ensure the vertical line is within the visible range</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">])</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Increments of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Increment&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">self_averaging_time</span></div>


<div class="viewcode-block" id="Process.empirical_properties">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.empirical_properties">[docs]</a>
    <span class="k">def</span> <span class="nf">empirical_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the empirical statistical properties of the process and compare them with the theoretical properties (parameters).</span>
<span class="sd">        Check if they are equal.</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.differential">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.differential">[docs]</a>
    <span class="k">def</span> <span class="nf">differential</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the differential of the process.</span>

<span class="sd">        :return: The differential of the process</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.closed_formula">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.closed_formula">[docs]</a>
    <span class="k">def</span> <span class="nf">closed_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the closed formula for the process using symbolic calculations and Ito calculus when possible.</span>

<span class="sd">        :return: The closed formula for the process</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The closed formula for this process is not yet implemented&#39;</span><span class="p">)</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.simulate_ensemble">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.simulate_ensemble">[docs]</a>
    <span class="k">def</span> <span class="nf">simulate_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">timestep_default</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_instances_default</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate the process ensemble for a given time and return the ensemble of instances using analytical approximation when possible.</span>

<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: The number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param save: Whether to save the results to a file</span>
<span class="sd">        :type save: bool</span>
<span class="sd">        :return: The ensemble of instances of the process</span>
<span class="sd">        :rtype: np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.pdf_evolution">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.pdf_evolution">[docs]</a>
    <span class="k">def</span> <span class="nf">pdf_evolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_default</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">timestep_default</span><span class="p">,</span> <span class="n">num_instances</span><span class="o">=</span><span class="n">num_instances_default</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the evolution of the probability density function of the process.</span>

<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: The number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :return: The evolution of the probability density function of the process</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.p_measure">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.p_measure">[docs]</a>
    <span class="k">def</span> <span class="nf">p_measure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the probability density function corresponding to the objective probability measure used in the given process.</span>

<span class="sd">        :return: The probability density function corresponding to the objective probability measure</span>
<span class="sd">        :rtype: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.time_average_expression">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.time_average_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">time_average_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the symbolic expression for the time average of the process if possible.</span>

<span class="sd">        :return: The symbolic expression for the time average of the process</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Process.eternal_simulator">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.Process.eternal_simulator">[docs]</a>
    <span class="k">def</span> <span class="nf">eternal_simulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the simulated images for the process indefinitely every k steps.</span>

<span class="sd">        :param timestep: Time step for the simulation.</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: Number of instances to simulate.</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :param k: Number of steps after which to update the plot.</span>
<span class="sd">        :type k: int</span>
<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        :exception ValueError: If the eternal simulator is not available for the process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_class</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_simulator</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>

            <span class="n">num_instances</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">_simulation&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

            <span class="n">csv_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span>
                                         <span class="s2">&quot;simulation_data.csv&quot;</span><span class="p">)</span>  <span class="c1"># Add this line to set the path for CSV file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                      <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>  <span class="c1"># Add this line to open the CSV file for writing</span>
                <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>  <span class="c1"># Add this line to create a CSV writer object</span>

                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Eternal Simulation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>

                <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">img_counter</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">def</span> <span class="nf">update_plot</span><span class="p">():</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">all_data</span><span class="p">:</span>
                        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
                        <span class="n">yrange</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">yrange</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;simulation.png&quot;</span><span class="p">))</span>

                <span class="k">def</span> <span class="nf">simulate</span><span class="p">():</span>
                    <span class="k">nonlocal</span> <span class="n">t</span><span class="p">,</span> <span class="n">img_counter</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                                <span class="n">t</span> <span class="o">+=</span> <span class="n">timestep</span>
                                <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                                <span class="n">dX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_increment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
                                <span class="n">X</span> <span class="o">+=</span> <span class="n">dX</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
                                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">img_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">update_plot</span><span class="p">()</span>
                            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">)]</span>
                            <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                            <span class="n">csv_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in simulation thread: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">simulation_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">simulate</span><span class="p">)</span>
                <span class="n">simulation_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation stopped by user.&quot;</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
                    <span class="n">simulation_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">simulation_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Simulation thread did not exit cleanly.&quot;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The eternal simulator is not available for this process because an external simulator is used for it. To use this method, an internal simulator must be implemented.&quot;</span><span class="p">)</span></div>
</div>


<span class="kn">from</span> <span class="nn">ergodicity.tools.solve</span> <span class="kn">import</span> <span class="n">solve</span>
<span class="kn">from</span> <span class="nn">ergodicity.tools.solve</span> <span class="kn">import</span> <span class="n">solve_fokker_planck</span>
<span class="kn">from</span> <span class="nn">ergodicity.tools.compute</span> <span class="kn">import</span> <span class="n">solve_fokker_planck_numerically</span>

<div class="viewcode-block" id="ItoProcess">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.ItoProcess">[docs]</a>
<span class="k">class</span> <span class="nc">ItoProcess</span><span class="p">(</span><span class="n">Process</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class representing an Ito process.</span>
<span class="sd">    Ito calculus can be applied to Ito processes.</span>
<span class="sd">    All Ito processes have drift and stochastic term.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        drift_term: The drift term of the process</span>

<span class="sd">        stochastic_term: The stochastic term of the process</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">process_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">drift_term</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stochastic_term</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Ito process with the given name, process class, drift term, and stochastic term.</span>

<span class="sd">        :param name: The name of the process</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param process_class: The class of the process</span>
<span class="sd">        :type process_class: Type[Any]</span>
<span class="sd">        :param drift_term: The drift term of the process</span>
<span class="sd">        :type drift_term: float</span>
<span class="sd">        :param stochastic_term: The stochastic term of the process</span>
<span class="sd">        :type stochastic_term: float</span>
<span class="sd">        :raises ValueError: If the stochastic term is negative</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">independent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ito</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">process_class</span><span class="o">=</span><span class="n">process_class</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drift_term</span> <span class="o">=</span> <span class="n">drift_term</span>
        <span class="k">if</span> <span class="n">stochastic_term</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stochastic_term</span> <span class="o">=</span> <span class="n">stochastic_term</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The stochastic term must be greater than or equal to zero.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">drift_term</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the drift term of the process.</span>

<span class="sd">        :return: The drift term of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drift_term</span>

    <span class="nd">@drift_term</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">drift_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drift_term</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the drift term of the process.</span>

<span class="sd">        :param drift_term: The drift term of the process</span>
<span class="sd">        :type drift_term: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drift_term</span> <span class="o">=</span> <span class="n">drift_term</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stochastic_term</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the stochastic term of the process.</span>

<span class="sd">        :return: The stochastic term of the process</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stochastic_term</span>

    <span class="nd">@stochastic_term</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">stochastic_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stochastic_term</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the stochastic term of the process.</span>

<span class="sd">        :param stochastic_term: The stochastic term of the process</span>
<span class="sd">        :type stochastic_term: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stochastic_term</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stochastic_term</span> <span class="o">=</span> <span class="n">stochastic_term</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The stochastic term must be greater than or equal to zero.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ItoProcess.solve">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.ItoProcess.solve">[docs]</a>
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the analytical solution for the given Ito process using Ito calculus.</span>

<span class="sd">        :return: The analytical solution for the Ito process</span>
<span class="sd">        :rtype: Sympy expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_drift_term</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stochastic_term</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span></div>


<div class="viewcode-block" id="ItoProcess.differential">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.ItoProcess.differential">[docs]</a>
    <span class="k">def</span> <span class="nf">differential</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the differential of the process.</span>

<span class="sd">        :return: The differential of the process</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;dX = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_drift_term</span><span class="si">}</span><span class="s2"> * dt + </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_stochastic_term</span><span class="si">}</span><span class="s2"> * dW&quot;</span></div>
</div>



<div class="viewcode-block" id="NonItoProcess">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.NonItoProcess">[docs]</a>
<span class="k">class</span> <span class="nc">NonItoProcess</span><span class="p">(</span><span class="n">Process</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class representing a non-Ito process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">process_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the non-Ito process with the given name and process class.</span>

<span class="sd">        :param name: The name of the process</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param process_class: The class of the process</span>
<span class="sd">        :type process_class: Type[Any]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">independent</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ito</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">process_class</span><span class="o">=</span><span class="n">process_class</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomProcess">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.CustomProcess">[docs]</a>
<span class="k">class</span> <span class="nc">CustomProcess</span><span class="p">(</span><span class="n">Process</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class representing a custom process.</span>
<span class="sd">    This class can be used by user to create custom processes in an easy way.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the custom process with the given name.</span>

<span class="sd">        :param name:</span>
<span class="sd">        :type name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">independent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ito</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">process_class</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom</span> <span class="o">=</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="simulation_decorator">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.simulation_decorator">[docs]</a>
<span class="k">def</span> <span class="nf">simulation_decorator</span><span class="p">(</span><span class="n">simulate_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator for simulation methods to add verbose option.</span>

<span class="sd">    :param simulate_func: The simulation method to decorate</span>
<span class="sd">    :type simulate_func: Callable</span>
<span class="sd">    :return: The decorated simulation method</span>
<span class="sd">    :rtype: Callable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">timestep</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper function for the simulation method.</span>

<span class="sd">        :param t: The time to simulate</span>
<span class="sd">        :type t: float</span>
<span class="sd">        :param timestep: The time step for the simulation</span>
<span class="sd">        :type timestep: float</span>
<span class="sd">        :param num_instances: The number of instances to simulate</span>
<span class="sd">        :type num_instances: int</span>
<span class="sd">        :return: The simulation data</span>
<span class="sd">        :rtype: NumPy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_steps</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_for_simulation</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">num_instances</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_instances</span><span class="p">):</span>
            <span class="n">X</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">num_instances</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulating instance </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
                <span class="n">dX</span> <span class="o">=</span> <span class="n">simulate_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">timestep</span><span class="p">)</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">dX</span>
                <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">num_steps</span><span class="o">&gt;</span><span class="mi">1000000</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">1000000</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulating instance </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">, X = </span><span class="si">{</span><span class="n">X</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">times</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>


<div class="viewcode-block" id="check_simulate_with_differential">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.check_simulate_with_differential">[docs]</a>
<span class="k">def</span> <span class="nf">check_simulate_with_differential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the simulate method uses the differential method.</span>

<span class="sd">    :param self: The process object</span>
<span class="sd">    :type self: Process</span>
<span class="sd">    :return: True if the simulate method uses the differential method, False otherwise</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_with_differential</span></div>



<div class="viewcode-block" id="create_correlation_matrix">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.create_correlation_matrix">[docs]</a>
<span class="k">def</span> <span class="nf">create_correlation_matrix</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">correlation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a correlation matrix with given correlations between all elements.</span>

<span class="sd">    :param size: The size of the correlation matrix</span>
<span class="sd">    :type size: int</span>
<span class="sd">    :param correlation: The correlation value for all off-diagonal elements</span>
<span class="sd">    :type correlation: float</span>
<span class="sd">    :return: The correlation matrix</span>
<span class="sd">    :rtype: np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">correlation</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">correlation</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Correlation must be between -1 and 1, exclusive.&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize the correlation matrix with the correlation value</span>
    <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="n">correlation</span><span class="p">)</span>

    <span class="c1"># Set the diagonal elements to 1 (self-correlation)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">corr_matrix</span></div>


<div class="viewcode-block" id="correlation_to_covariance">
<a class="viewcode-back" href="../../../ergodicity.process.html#ergodicity.process.definitions.correlation_to_covariance">[docs]</a>
<span class="k">def</span> <span class="nf">correlation_to_covariance</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">std_devs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform a correlation matrix into a variance-covariance matrix.</span>

<span class="sd">    :param correlation_matrix: The correlation matrix</span>
<span class="sd">    :type correlation_matrix: np.ndarray</span>
<span class="sd">    :param std_devs: The standard deviations of the variables</span>
<span class="sd">    :type std_devs: np.ndarray</span>
<span class="sd">    :return: The variance-covariance matrix</span>
<span class="sd">    :rtype: np.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">std_devs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std_devs</span><span class="p">)</span>
    <span class="n">covariance_matrix</span> <span class="o">=</span> <span class="n">correlation_matrix</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">std_devs</span><span class="p">,</span> <span class="n">std_devs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">covariance_matrix</span></div>



</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Ergodicity Library</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Ihor Kendiukhov.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>