<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ergodicity.agents.probability_weighting &#8212; Ergodicity Library 0.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=e259d695"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ergodicity.agents.probability_weighting</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">probability_weighting Submodule Overview</span>

<span class="sd">The **`probability_weighting`** submodule provides tools for computing and visualizing probability weighting functions in stochastic processes, particularly focusing on how different drifts and diffusions influence stochastic trajectories under changes of measure (e.g., Girsanov&#39;s theorem).</span>

<span class="sd">Key Features:</span>

<span class="sd">1. **Girsanov&#39;s Theorem**:</span>

<span class="sd">   - Apply Girsanov&#39;s theorem to transform a probability measure in Geometric Brownian Motion (GBM) and other martingale processes.</span>

<span class="sd">   - Adjusts the drift of the process based on the probability weighting function.</span>

<span class="sd">2. **Stochastic Simulation**:</span>

<span class="sd">   - Simulate weighted stochastic processes based on the drift and volatility parameters using the adjusted probability density function (PDF).</span>

<span class="sd">3. **Visualization**:</span>

<span class="sd">   - Provides functions for simulating and plotting stochastic trajectories under different probability weighting schemes.</span>

<span class="sd">Example Usage:</span>

<span class="sd">from ergodicity.probability_weighting import gbm_weighting, visualize_weighting</span>

<span class="sd"># Parameters for Geometric Brownian Motion (GBM)</span>

<span class="sd">initial_mu = 0.05  # Initial drift</span>

<span class="sd">sigma = 0.2  # Volatility</span>

<span class="sd"># Get the weighted PDF using Girsanov&#39;s theorem</span>

<span class="sd">weighted_pdf = gbm_weighting(initial_mu, sigma)</span>

<span class="sd"># Visualize the weighted process</span>

<span class="sd">new_mu = 0.03  # New drift for visualization</span>

<span class="sd">X = visualize_weighting(weighted_pdf, new_mu, sigma, timestep=0.01, num_samples=1000, t=1.0)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">tenacity</span> <span class="kn">import</span> <span class="n">wait_exponential_jitter</span>
<span class="kn">from</span> <span class="nn">ergodicity.configurations</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ergodicity.process.default_values</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ergodicity.tools.compute</span> <span class="kn">import</span> <span class="n">random_variable_from_pdf</span>
<span class="kn">from</span> <span class="nn">ergodicity.tools.solve</span> <span class="kn">import</span> <span class="n">apply_girsanov</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<div class="viewcode-block" id="gbm_weighting">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.agents.html#ergodicity.agents.probability_weighting.gbm_weighting">[docs]</a>
<span class="k">def</span> <span class="nf">gbm_weighting</span><span class="p">(</span><span class="n">initial_mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">time_horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply Girsanov&#39;s theorem to transform the probability measure of a Geometric Brownian Motion (GBM) process to a new measure.</span>
<span class="sd">    The new measure is defined by adjusting the drift of the GBM process.</span>

<span class="sd">    :param initial_mu: Initial drift of the GBM process. It corresponds to the intended time average of the process. So you insert the time average to get such probability weighting that taking expected value under the new measure gives the time average.</span>
<span class="sd">    :type initial_mu: float</span>
<span class="sd">    :param sigma: Volatility of the GBM process.</span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :return: Weighted probability density function (PDF) after applying Girsanov&#39;s theorem.</span>
<span class="sd">    :rtype: sympy.core.add.Add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># t = sp.symbols(&#39;t&#39;)</span>
    <span class="c1"># new_drift = initial_mu - 0.5 * sigma**2</span>
    <span class="c1"># weighted_pdf = apply_girsanov(initial_drift=initial_mu, new_drift=new_drift, diffusion=sigma, time_horizon=t)</span>
    <span class="c1"># return weighted_pdf</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">new_drift</span> <span class="o">=</span> <span class="p">(</span><span class="n">initial_mu</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;new_drift: </span><span class="si">{</span><span class="n">new_drift</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">initial_mu</span> <span class="o">=</span> <span class="n">initial_mu</span><span class="o">*</span><span class="n">x</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">*</span><span class="n">x</span>
    <span class="n">weighted_pdf</span> <span class="o">=</span> <span class="n">apply_girsanov</span><span class="p">(</span><span class="n">initial_drift</span><span class="o">=</span><span class="n">initial_mu</span><span class="p">,</span> <span class="n">new_drift</span><span class="o">=</span><span class="n">new_drift</span><span class="p">,</span> <span class="n">diffusion</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
                                  <span class="n">time_horizon</span><span class="o">=</span><span class="n">time_horizon</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weighted_pdf</span></div>


<div class="viewcode-block" id="martingale_weighting">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.agents.html#ergodicity.agents.probability_weighting.martingale_weighting">[docs]</a>
<span class="k">def</span> <span class="nf">martingale_weighting</span><span class="p">(</span><span class="n">initial_mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply Girsanov&#39;s theorem to transform the probability measure of a martingale process to a new measure.</span>
<span class="sd">    The new measure is defined by adjusting the drift of the martingale process.</span>

<span class="sd">    :param initial_mu: Initial drift of the martingale process.</span>
<span class="sd">    :param initial_mu: float</span>
<span class="sd">    :param sigma: Volatility of the martingale process.</span>
<span class="sd">    :param sigma: float</span>
<span class="sd">    :return: Weighted probability density function (PDF) after applying Girsanov&#39;s theorem.</span>
<span class="sd">    :rtype: sympy.core.add.Add</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">new_drift</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">weighted_pdf</span> <span class="o">=</span> <span class="n">apply_girsanov</span><span class="p">(</span><span class="n">initial_drift</span><span class="o">=</span><span class="n">initial_mu</span><span class="p">,</span> <span class="n">new_drift</span><span class="o">=</span><span class="n">new_drift</span><span class="p">,</span> <span class="n">diffusion</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">time_horizon</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weighted_pdf</span></div>



<div class="viewcode-block" id="visualize_weighting">
<a class="viewcode-back" href="../../../ergodicity/docs/source/ergodicity.agents.html#ergodicity.agents.probability_weighting.visualize_weighting">[docs]</a>
<span class="k">def</span> <span class="nf">visualize_weighting</span><span class="p">(</span><span class="n">weighted_pdf</span><span class="p">,</span> <span class="n">new_mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the weighted stochastic process based on the adjusted drift and volatility parameters.</span>

<span class="sd">    :param weighted_pdf: Weighted probability density function.</span>
<span class="sd">    :type weighted_pdf: sympy.core.add.Add</span>
<span class="sd">    :param new_mu: New drift parameter.</span>
<span class="sd">    :type new_mu: float</span>
<span class="sd">    :param sigma: Volatility parameter.</span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :param timestep: Time step for simulation.</span>
<span class="sd">    :type timestep: float</span>
<span class="sd">    :param num_samples: Number of sample paths to simulate.</span>
<span class="sd">    :type num_samples: int</span>
<span class="sd">    :param t: Total time for simulation.</span>
<span class="sd">    :type t: float</span>
<span class="sd">    :return: Simulated paths.</span>
<span class="sd">    :rtype: numpy.ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">timestep</span>
    <span class="n">num_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">W_t</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;W_t&#39;</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">):</span>
        <span class="n">current_x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">dW_q</span> <span class="o">=</span> <span class="n">dt</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">random_variable_from_pdf</span><span class="p">(</span><span class="n">weighted_pdf</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">W_t</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dW_q</span><span class="p">)</span>
        <span class="n">dX</span> <span class="o">=</span> <span class="n">current_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">new_mu</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">dW_q</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dX</span><span class="p">)</span>
        <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dX</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_steps</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simulated Paths of Weighted Process&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">X</span></div>





</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Ergodicity Library</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Ihor Kendiukhov.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>